---
interface Props {
  initialQuery?: string;
}

const { initialQuery = '' } = Astro.props;
---

<form id="search-form" class="search-bar">
  <div class="search-input-wrapper">
    <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
      <path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16zM18 18l-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
    <input
      type="text"
      id="search-input"
      name="q"
      placeholder="Search movies by title, director, cast, or genre..."
      value={initialQuery}
      class="search-input"
    />
    <button type="submit" class="search-button">Search</button>
  </div>
</form>

<script>
  document.getElementById('search-form')?.addEventListener('submit', function(e) {
    e.preventDefault();
    const input = document.getElementById('search-input') as HTMLInputElement;
    const query = input.value.trim();
    if (query) {
      // Construct URL preserving current protocol, host, and port
      const searchUrl = new URL('/search', window.location.origin);
      searchUrl.searchParams.set('q', query);
      window.location.href = searchUrl.href;
    }
  });
</script>

<style>
  .search-bar {
    margin: 2rem 0;
  }

  .search-input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
    max-width: 600px;
  }

  .search-icon {
    position: absolute;
    left: 1rem;
    color: var(--text-muted);
    pointer-events: none;
  }

  .search-input {
    flex: 1;
    padding: 0.75rem 1rem 0.75rem 3rem;
    font-size: 1rem;
    border: 2px solid var(--border-color);
    border-radius: 8px 0 0 8px;
    background: var(--card-bg);
    color: var(--text-color);
    transition: border-color 0.2s;
  }

  .search-input:focus {
    outline: none;
    border-color: var(--accent-color);
  }

  .search-button {
    padding: 0.75rem 1.5rem;
    font-size: 1rem;
    font-weight: 600;
    background: var(--accent-color);
    color: var(--bg-color);
    border: none;
    border-radius: 0 8px 8px 0;
    cursor: pointer;
    transition: opacity 0.2s;
  }

  .search-button:hover {
    opacity: 0.9;
  }

  @media (max-width: 640px) {
    .search-input-wrapper {
      max-width: 100%;
    }

    .search-button {
      padding: 0.75rem 1rem;
    }
  }
</style>
