# Ralph Progress Log
# Project: MovieVault v1.2 Scanner Overhaul
# Branch: ralph/v1.2-scanner-overhaul
# Started: 2026-01-30
# ---

## 2026-02-02: US-001 - Add GetMovieByID method to TMDB client

### What was done:
- Added `GetMovieByID(tmdbID int) (*writer.Movie, error)` method to `internal/metadata/tmdb.go`
- Method directly calls TMDB `/movie/{id}` endpoint (via existing `GetMovieDetails`) bypassing search
- Fetches credits via existing `GetMovieCredits` call
- Returns fully populated `*writer.Movie` struct matching `GetFullMovieData` output format
- Added `ErrMovieNotFound` sentinel error for proper 404 handling
- Fixed pre-existing lint issue in `cmd/scanner/main.go` (redundant newline in fmt.Println)

### Files modified:
- `internal/metadata/tmdb.go` - Added GetMovieByID method and ErrMovieNotFound error
- `cmd/scanner/main.go` - Fixed lint issue (unrelated to US-001 but blocked tests)

### Verification:
- `go build ./...` - passes
- `go test ./...` - passes (no test files exist yet)
- `go vet ./...` - passes

### Notes for next developer:
- US-002 is the logical next step - it will integrate GetMovieByID into the scanner's NFO processing flow
- The method reuses existing GetMovieDetails and GetMovieCredits methods to maintain consistency
- ErrMovieNotFound can be checked with `errors.Is(err, metadata.ErrMovieNotFound)` for fallback logic

## 2026-02-02: US-002 - Use TMDB ID from NFO for direct lookup

### What was done:
- Modified `cmd/scanner/main.go` to use direct TMDB ID lookup when NFO contains a valid TMDBID
- Added `errors` import for proper sentinel error checking
- When NFO contains TMDBID > 0, calls `GetMovieByID` instead of `GetFullMovieData`
- If `GetMovieByID` returns 404 error (checked via `errors.Is(err, metadata.ErrMovieNotFound)`), falls back to title/year search
- If TMDBID is 0 or missing, uses existing title/year search behavior
- Added verbose logging for TMDB lookup method ("direct ID", "search", "search (fallback from direct)")

### Files modified:
- `cmd/scanner/main.go` - Added TMDB ID direct lookup integration with NFO processing

### Verification:
- `go build ./...` - passes
- `go test ./...` - passes (no test files exist yet)
- `go vet ./...` - passes
- Note: npm typecheck/test not available in website - environmental esbuild ARM64 compatibility issue unrelated to Go code changes

### Notes for next developer:
- US-003 (Add retry package with exponential backoff) is the next logical step
- The direct lookup improves metadata accuracy by avoiding title search ambiguity when TMDB ID is known
- Verbose mode now shows which lookup method was used for debugging
- The mergeMovieData function is still used to combine NFO data with TMDB data (NFO takes priority)

